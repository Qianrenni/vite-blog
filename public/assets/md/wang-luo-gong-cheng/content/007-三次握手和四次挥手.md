# **三次握手和四次挥手**

## **三次握手**

三次握手用于TCP连接的建立，确保双方都能发送和接收数据。具体步骤如下：

1. **第一次握手（SYN）**：客户端向服务器发送一个SYN（同步序列编号，Synchronize Sequence Numbers）包，表示希望与服务器建立连接。此包中包含了客户端初始的序列号。

2. **第二次握手（SYN-ACK）**：服务器收到客户端的SYN包后，会回复一个SYN-ACK（确认字符，Acknowledgement）包作为响应。这个包同时包含服务器的初始序列号以及对客户端序列号的确认信息（即客户端序列号加1）。

3. **第三次握手（ACK）**：客户端接收到服务器的SYN-ACK包后，发送一个ACK包给服务器，确认收到了服务器的响应。此时，客户端和服务器都进入ESTABLISHED状态，表示连接已经成功建立，可以开始进行数据传输。

通过这三次握手，双方不仅确认了彼此的存在，还交换了初始序列号，为后续的数据传输做好准备。

## **四次挥手**

四次挥手用于TCP连接的正常终止，目的是确保所有数据都已经正确传输完毕，并释放资源。具体步骤如下：

1. **第一次挥手（FIN）**：主动关闭方（通常是客户端）发送一个FIN包，通知被动关闭方（通常是服务器）它已完成了数据发送，想要断开连接。

2. **第二次挥手（ACK）**：被动关闭方收到FIN包后，会发送一个ACK包作为回应，确认收到了对方的关闭请求。此时，主动关闭方到被动关闭方的方向上的连接已被关闭，但被动关闭方到主动关闭方的方向上可能仍有未传输完的数据或应答。

3. **第三次挥手（FIN）**：当被动关闭方也完成了数据发送后，它会发送一个FIN包给主动关闭方，表明自己也准备好断开连接。

4. **第四次挥手（ACK）**：主动关闭方收到被动关闭方的FIN包后，发送最后一个ACK包作为确认。之后，被动关闭方在等待一段时间（通常是两个最大段生命周期，即2MSL，以确保ACK包已经被对方收到）后，最终关闭连接。

四次挥手确保了双方都有机会完成当前正在进行的操作，并且都同意终止连接，从而避免了任何一方的数据丢失。

总结来说，三次握手保证了TCP连接的可靠建立，而四次挥手则确保了连接能够安全、有序地终止。这两个过程对于维持TCP连接的稳定性和可靠性至关重要。