## 9.1 Web框架

### 标准库net/http

```go
package main

import (
    "context"
    "encoding/json"
    "fmt"
    "log"
    "net/http"
    "strconv"
    "time"
)

// 用户结构体
type User struct {
    ID    int    `json:"id"`
    Name  string `json:"name"`
    Email string `json:"email"`
}

// 响应结构体
type Response struct {
    Success bool        `json:"success"`
    Data    interface{} `json:"data,omitempty"`
    Message string      `json:"message,omitempty"`
    Error   string      `json:"error,omitempty"`
}

// 简单的用户存储（实际应用中应该使用数据库）
var users = map[int]*User{
    1: {ID: 1, Name: "Alice", Email: "alice@example.com"},
    2: {ID: 2, Name: "Bob", Email: "bob@example.com"},
}

// 基础HTTP处理器
func helloHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodGet {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    response := Response{
        Success: true,
        Data:    "Hello, World!",
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// 获取所有用户
func getUsersHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodGet {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    userList := make([]*User, 0, len(users))
    for _, user := range users {
        userList = append(userList, user)
    }
    
    response := Response{
        Success: true,
        Data:    userList,
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// 获取单个用户
func getUserHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodGet {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    // 从URL中提取用户ID
    idStr := r.URL.Query().Get("id")
    if idStr == "" {
        http.Error(w, "Missing user ID", http.StatusBadRequest)
        return
    }
    
    id, err := strconv.Atoi(idStr)
    if err != nil {
        http.Error(w, "Invalid user ID", http.StatusBadRequest)
        return
    }
    
    user, exists := users[id]
    if !exists {
        http.Error(w, "User not found", http.StatusNotFound)
        return
    }
    
    response := Response{
        Success: true,
        Data:    user,
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// 创建用户
func createUserHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodPost {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    var user User
    if err := json.NewDecoder(r.Body).Decode(&user); err != nil {
        http.Error(w, "Invalid JSON", http.StatusBadRequest)
        return
    }
    
    // 简单的验证
    if user.Name == "" || user.Email == "" {
        http.Error(w, "Name and email are required", http.StatusBadRequest)
        return
    }
    
    // 分配新ID
    maxID := 0
    for id := range users {
        if id > maxID {
            maxID = id
        }
    }
    user.ID = maxID + 1
    
    users[user.ID] = &user
    
    response := Response{
        Success: true,
        Data:    user,
        Message: "User created successfully",
    }
    
    w.Header().Set("Content-Type", "application/json")
    w.WriteHeader(http.StatusCreated)
    json.NewEncoder(w).Encode(response)
}

// 更新用户
func updateUserHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodPut {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    // 从URL中提取用户ID
    idStr := r.URL.Query().Get("id")
    if idStr == "" {
        http.Error(w, "Missing user ID", http.StatusBadRequest)
        return
    }
    
    id, err := strconv.Atoi(idStr)
    if err != nil {
        http.Error(w, "Invalid user ID", http.StatusBadRequest)
        return
    }
    
    user, exists := users[id]
    if !exists {
        http.Error(w, "User not found", http.StatusNotFound)
        return
    }
    
    var updatedUser User
    if err := json.NewDecoder(r.Body).Decode(&updatedUser); err != nil {
        http.Error(w, "Invalid JSON", http.StatusBadRequest)
        return
    }
    
    // 更新用户信息
    if updatedUser.Name != "" {
        user.Name = updatedUser.Name
    }
    if updatedUser.Email != "" {
        user.Email = updatedUser.Email
    }
    
    response := Response{
        Success: true,
        Data:    user,
        Message: "User updated successfully",
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// 删除用户
func deleteUserHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodDelete {
        http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        return
    }
    
    // 从URL中提取用户ID
    idStr := r.URL.Query().Get("id")
    if idStr == "" {
        http.Error(w, "Missing user ID", http.StatusBadRequest)
        return
    }
    
    id, err := strconv.Atoi(idStr)
    if err != nil {
        http.Error(w, "Invalid user ID", http.StatusBadRequest)
        return
    }
    
    if _, exists := users[id]; !exists {
        http.Error(w, "User not found", http.StatusNotFound)
        return
    }
    
    delete(users, id)
    
    response := Response{
        Success: true,
        Message: "User deleted successfully",
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

// 路由分发器
func routeHandler(w http.ResponseWriter, r *http.Request) {
    switch r.URL.Path {
    case "/hello":
        helloHandler(w, r)
    case "/users":
        switch r.Method {
        case http.MethodGet:
            if r.URL.Query().Get("id") != "" {
                getUserHandler(w, r)
            } else {
                getUsersHandler(w, r)
            }
        case http.MethodPost:
            createUserHandler(w, r)
        case http.MethodPut:
            updateUserHandler(w, r)
        case http.MethodDelete:
            deleteUserHandler(w, r)
        default:
            http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
        }
    default:
        http.NotFound(w, r)
    }
}

// CORS中间件
func corsMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set("Access-Control-Allow-Origin", "*")
        w.Header().Set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS")
        w.Header().Set("Access-Control-Allow-Headers", "Content-Type, Authorization")
        
        if r.Method == http.MethodOptions {
            w.WriteHeader(http.StatusOK)
            return
        }
        
        next(w, r)
    }
}

// 日志中间件
func loggingMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()
        log.Printf("[%s] %s %s", r.Method, r.URL.Path, r.RemoteAddr)
        
        next(w, r)
        
        log.Printf("[%s] %s completed in %v", r.Method, r.URL.Path, time.Since(start))
    }
}

// 认证中间件
func authMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // 简单的API密钥验证
        apiKey := r.Header.Get("X-API-Key")
        if apiKey != "secret-key" {
            http.Error(w, "Unauthorized", http.StatusUnauthorized)
            return
        }
        
        next(w, r)
    }
}

// 组合中间件
func applyMiddleware(handler http.HandlerFunc, middlewares ...func(http.HandlerFunc) http.HandlerFunc) http.HandlerFunc {
    for i := len(middlewares) - 1; i >= 0; i-- {
        handler = middlewares[i](handler)
    }
    return handler
}

func main() {
    // 创建多路复用器
    mux := http.NewServeMux()
    
    // 注册路由和中间件
    mux.HandleFunc("/hello", applyMiddleware(helloHandler, loggingMiddleware, corsMiddleware))
    mux.HandleFunc("/users", applyMiddleware(routeHandler, loggingMiddleware, corsMiddleware, authMiddleware))
    
    // 创建服务器
    server := &http.Server{
        Addr:         ":8080",
        Handler:      mux,
        ReadTimeout:  10 * time.Second,
        WriteTimeout: 10 * time.Second,
        IdleTimeout:  60 * time.Second,
    }
    
    log.Println("Server starting on :8080")
    log.Fatal(server.ListenAndServe())
}
```

### Gin框架

```go
package main

import (
    "net/http"
    "time"
    "github.com/gin-gonic/gin"
    "github.com/gin-gonic/gin/binding"
    "github.com/go-playground/validator/v10"
)

// 用户结构体
type User struct {
    ID    int    `json:"id" binding:"required"`
    Name  string `json:"name" binding:"required,min=2,max=50"`
    Email string `json:"email" binding:"required,email"`
}

// 自定义验证器
type UserCreateRequest struct {
    Name  string `json:"name" binding:"required,min=2,max=50"`
    Email string `json:"email" binding:"required,email"`
}

type UserUpdateRequest struct {
    Name  string `json:"name" binding:"omitempty,min=2,max=50"`
    Email string `json:"email" binding:"omitempty,email"`
}

// 模拟数据库
var users = map[int]*User{
    1: {ID: 1, Name: "Alice", Email: "alice@example.com"},
    2: {ID: 2, Name: "Bob", Email: "bob@example.com"},
}

func main() {
    // 创建Gin引擎
    r := gin.New()
    
    // 使用内置中间件
    r.Use(gin.Logger())
    r.Use(gin.Recovery())
    
    // 自定义中间件
    r.Use(corsMiddleware())
    r.Use(loggingMiddleware())
    
    // API路由组
    api := r.Group("/api/v1")
    {
        api.GET("/hello", helloHandler)
        api.GET("/users", getUsersHandler)
        api.GET("/users/:id", getUserHandler)
        api.POST("/users", createUserHandler)
        api.PUT("/users/:id", updateUserHandler)
        api.DELETE("/users/:id", deleteUserHandler)
    }
    
    // 健康检查
    r.GET("/health", healthHandler)
    
    // 静态文件服务
    r.Static("/static", "./static")
    
    // 启动服务器
    r.Run(":8080")
}

// 中间件
func corsMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Header("Access-Control-Allow-Origin", "*")
        c.Header("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS")
        c.Header("Access-Control-Allow-Headers", "Origin, Content-Type, Authorization")
        
        if c.Request.Method == "OPTIONS" {
            c.AbortWithStatus(204)
            return
        }
        
        c.Next()
    }
}

func loggingMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        start := time.Now()
        path := c.Request.URL.Path
        raw := c.Request.URL.RawQuery
        
        c.Next()
        
        latency := time.Since(start)
        clientIP := c.ClientIP()
        method := c.Request.Method
        statusCode := c.Writer.Status()
        
        if raw != "" {
            path = path + "?" + raw
        }
        
        log.Printf("[GIN] %v |%3d| %13v | %15s | %-7s %#v\n",
            time.Now().Format("2006/01/02 - 15:04:05"),
            statusCode,
            latency,
            clientIP,
            method,
            path,
        )
    }
}

// 处理器函数
func helloHandler(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "message": "Hello, World!",
        "success": true,
    })
}

func healthHandler(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "status": "healthy",
        "uptime": time.Now().Format("2006-01-02 15:04:05"),
    })
}

func getUsersHandler(c *gin.Context) {
    userList := make([]*User, 0, len(users))
    for _, user := range users {
        userList = append(userList, user)
    }
    
    c.JSON(http.StatusOK, gin.H{
        "success": true,
        "data":    userList,
        "count":   len(userList),
    })
}

func getUserHandler(c *gin.Context) {
    id := c.Param("id")
    userID, err := c.GetInt("id")
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{
            "success": false,
            "error":   "Invalid user ID",
        })
        return
    }
    
    user, exists := users[userID]
    if !exists {
        c.JSON(http.StatusNotFound, gin.H{
            "success": false,
            "error":   "User not found",
        })
        return
    }
    
    c.JSON(http.StatusOK, gin.H{
        "success": true,
        "data":    user,
    })
}

func createUserHandler(c *gin.Context) {
    var req UserCreateRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{
            "success": false,
            "error":   err.Error(),
        })
        return
    }
    
    // 分配新ID
    maxID := 0
    for id := range users {
        if id > maxID {
            maxID = id
        }
    }
    newID := maxID + 1
    
    user := &User{
        ID:    newID,
        Name:  req.Name,
        Email: req.Email,
    }
    
    users[newID] = user
    
    c.JSON(http.StatusCreated, gin.H{
        "success": true,
        "data":    user,
        "message": "User created successfully",
    })
}

func updateUserHandler(c *gin.Context) {
    id := c.Param("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{
            "success": false,
            "error":   "Invalid user ID",
        })
        return
    }
    
    user, exists := users[userID]
    if !exists {
        c.JSON(http.StatusNotFound, gin.H{
            "success": false,
            "error":   "User not found",
        })
        return
    }
    
    var req UserUpdateRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{
            "success": false,
            "error":   err.Error(),
        })
        return
    }
    
    // 更新用户信息
    if req.Name != "" {
        user.Name = req.Name
    }
    if req.Email != "" {
        user.Email = req.Email
    }
    
    c.JSON(http.StatusOK, gin.H{
        "success": true,
        "data":    user,
        "message": "User updated successfully",
    })
}

func deleteUserHandler(c *gin.Context) {
    id := c.Param("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{
            "success": false,
            "error":   "Invalid user ID",
        })
        return
    }
    
    if _, exists := users[userID]; !exists {
        c.JSON(http.StatusNotFound, gin.H{
            "success": false,
            "error":   "User not found",
        })
        return
    }
    
    delete(users, userID)
    
    c.JSON(http.StatusOK, gin.H{
        "success": true,
        "message": "User deleted successfully",
    })
}

// 自定义验证器示例
func init() {
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
        v.RegisterValidation("custom_email", customEmailValidator)
    }
}

func customEmailValidator(fl validator.FieldLevel) bool {
    email := fl.Field().String()
    // 简单的邮箱验证逻辑
    return len(email) > 5 && email[len(email)-4:] == ".com"
}
```

### Echo框架

```go
package main

import (
    "net/http"
    "time"
    "github.com/labstack/echo/v4"
    "github.com/labstack/echo/v4/middleware"
)

// 用户结构体
type User struct {
    ID    int    `json:"id"`
    Name  string `json:"name"`
    Email string `json:"email"`
}

type Response struct {
    Success bool        `json:"success"`
    Data    interface{} `json:"data,omitempty"`
    Message string      `json:"message,omitempty"`
    Error   string      `json:"error,omitempty"`
}

// 模拟数据库
var users = map[int]*User{
    1: {ID: 1, Name: "Alice", Email: "alice@example.com"},
    2: {ID: 2, Name: "Bob", Email: "bob@example.com"},
}

func main() {
    // 创建Echo实例
    e := echo.New()
    
    // 中间件
    e.Use(middleware.Logger())
    e.Use(middleware.Recover())
    e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
        AllowOrigins: []string{"*"},
        AllowMethods: []string{http.MethodGet, http.MethodPut, http.MethodPost, http.MethodDelete},
    }))
    
    // 自定义中间件
    e.Use(loggingMiddleware)
    
    // 路由
    e.GET("/hello", helloHandler)
    e.GET("/health", healthHandler)
    
    // API路由组
    api := e.Group("/api/v1")
    api.GET("/users", getUsersHandler)
    api.GET("/users/:id", getUserHandler)
    api.POST("/users", createUserHandler)
    api.PUT("/users/:id", updateUserHandler)
    api.DELETE("/users/:id", deleteUserHandler)
    
    // 启动服务器
    e.Logger.Fatal(e.Start(":8080"))
}

// 自定义中间件
func loggingMiddleware(next echo.HandlerFunc) echo.HandlerFunc {
    return func(c echo.Context) error {
        start := time.Now()
        
        if err := next(c); err != nil {
            c.Error(err)
        }
        
        log.Printf("[%s] %s %s - %v",
            c.Request().Method,
            c.Request().URL.Path,
            c.RealIP(),
            time.Since(start))
        
        return nil
    }
}

// 处理器函数
func helloHandler(c echo.Context) error {
    return c.JSON(http.StatusOK, Response{
        Success: true,
        Data:    "Hello, World!",
    })
}

func healthHandler(c echo.Context) error {
    return c.JSON(http.StatusOK, echo.Map{
        "status": "healthy",
        "uptime": time.Now().Format("2006-01-02 15:04:05"),
    })
}

func getUsersHandler(c echo.Context) error {
    userList := make([]*User, 0, len(users))
    for _, user := range users {
        userList = append(userList, user)
    }
    
    return c.JSON(http.StatusOK, Response{
        Success: true,
        Data:    userList,
        Message: "Users retrieved successfully",
    })
}

func getUserHandler(c echo.Context) error {
    id := c.Param("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    user, exists := users[userID]
    if !exists {
        return c.JSON(http.StatusNotFound, Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    return c.JSON(http.StatusOK, Response{
        Success: true,
        Data:    user,
    })
}

func createUserHandler(c echo.Context) error {
    user := new(User)
    if err := c.Bind(user); err != nil {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Invalid request body",
        })
    }
    
    // 验证必填字段
    if user.Name == "" || user.Email == "" {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Name and email are required",
        })
    }
    
    // 分配新ID
    maxID := 0
    for id := range users {
        if id > maxID {
            maxID = id
        }
    }
    user.ID = maxID + 1
    
    users[user.ID] = user
    
    return c.JSON(http.StatusCreated, Response{
        Success: true,
        Data:    user,
        Message: "User created successfully",
    })
}

func updateUserHandler(c echo.Context) error {
    id := c.Param("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    user, exists := users[userID]
    if !exists {
        return c.JSON(http.StatusNotFound, Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    updatedUser := new(User)
    if err := c.Bind(updatedUser); err != nil {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Invalid request body",
        })
    }
    
    // 更新用户信息
    if updatedUser.Name != "" {
        user.Name = updatedUser.Name
    }
    if updatedUser.Email != "" {
        user.Email = updatedUser.Email
    }
    
    return c.JSON(http.StatusOK, Response{
        Success: true,
        Data:    user,
        Message: "User updated successfully",
    })
}

func deleteUserHandler(c echo.Context) error {
    id := c.Param("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.JSON(http.StatusBadRequest, Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    if _, exists := users[userID]; !exists {
        return c.JSON(http.StatusNotFound, Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    delete(users, userID)
    
    return c.JSON(http.StatusOK, Response{
        Success: true,
        Message: "User deleted successfully",
    })
}
```

### Fiber框架

```go
package main

import (
    "strconv"
    "github.com/gofiber/fiber/v2"
    "github.com/gofiber/fiber/v2/middleware/cors"
    "github.com/gofiber/fiber/v2/middleware/logger"
    "github.com/gofiber/fiber/v2/middleware/recover"
)

// 用户结构体
type User struct {
    ID    int    `json:"id"`
    Name  string `json:"name"`
    Email string `json:"email"`
}

type Response struct {
    Success bool        `json:"success"`
    Data    interface{} `json:"data,omitempty"`
    Message string      `json:"message,omitempty"`
    Error   string      `json:"error,omitempty"`
}

// 模拟数据库
var users = map[int]*User{
    1: {ID: 1, Name: "Alice", Email: "alice@example.com"},
    2: {ID: 2, Name: "Bob", Email: "bob@example.com"},
}

func main() {
    // 创建Fiber应用
    app := fiber.New(fiber.Config{
        Prefork:       false,
        CaseSensitive: true,
        StrictRouting: true,
        ServerHeader:  "Fiber",
        AppName:       "MyApp v1.0.0",
    })
    
    // 中间件
    app.Use(logger.New())
    app.Use(recover.New())
    app.Use(cors.New())
    
    // 路由
    app.Get("/hello", helloHandler)
    app.Get("/health", healthHandler)
    
    // API路由组
    api := app.Group("/api/v1")
    api.Get("/users", getUsersHandler)
    api.Get("/users/:id", getUserHandler)
    api.Post("/users", createUserHandler)
    api.Put("/users/:id", updateUserHandler)
    api.Delete("/users/:id", deleteUserHandler)
    
    // 启动服务器
    app.Listen(":8080")
}

// 处理器函数
func helloHandler(c *fiber.Ctx) error {
    return c.JSON(Response{
        Success: true,
        Data:    "Hello, World!",
    })
}

func healthHandler(c *fiber.Ctx) error {
    return c.JSON(fiber.Map{
        "status": "healthy",
        "uptime": time.Now().Format("2006-01-02 15:04:05"),
    })
}

func getUsersHandler(c *fiber.Ctx) error {
    userList := make([]*User, 0, len(users))
    for _, user := range users {
        userList = append(userList, user)
    }
    
    return c.JSON(Response{
        Success: true,
        Data:    userList,
        Message: "Users retrieved successfully",
    })
}

func getUserHandler(c *fiber.Ctx) error {
    id := c.Params("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    user, exists := users[userID]
    if !exists {
        return c.Status(fiber.StatusNotFound).JSON(Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    return c.JSON(Response{
        Success: true,
        Data:    user,
    })
}

func createUserHandler(c *fiber.Ctx) error {
    user := new(User)
    if err := c.BodyParser(user); err != nil {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Invalid request body",
        })
    }
    
    // 验证必填字段
    if user.Name == "" || user.Email == "" {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Name and email are required",
        })
    }
    
    // 分配新ID
    maxID := 0
    for id := range users {
        if id > maxID {
            maxID = id
        }
    }
    user.ID = maxID + 1
    
    users[user.ID] = user
    
    return c.Status(fiber.StatusCreated).JSON(Response{
        Success: true,
        Data:    user,
        Message: "User created successfully",
    })
}

func updateUserHandler(c *fiber.Ctx) error {
    id := c.Params("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    user, exists := users[userID]
    if !exists {
        return c.Status(fiber.StatusNotFound).JSON(Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    updatedUser := new(User)
    if err := c.BodyParser(updatedUser); err != nil {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Invalid request body",
        })
    }
    
    // 更新用户信息
    if updatedUser.Name != "" {
        user.Name = updatedUser.Name
    }
    if updatedUser.Email != "" {
        user.Email = updatedUser.Email
    }
    
    return c.JSON(Response{
        Success: true,
        Data:    user,
        Message: "User updated successfully",
    })
}

func deleteUserHandler(c *fiber.Ctx) error {
    id := c.Params("id")
    userID, err := strconv.Atoi(id)
    if err != nil {
        return c.Status(fiber.StatusBadRequest).JSON(Response{
            Success: false,
            Error:   "Invalid user ID",
        })
    }
    
    if _, exists := users[userID]; !exists {
        return c.Status(fiber.StatusNotFound).JSON(Response{
            Success: false,
            Error:   "User not found",
        })
    }
    
    delete(users, userID)
    
    return c.JSON(Response{
        Success: true,
        Message: "User deleted successfully",
    })
}
```

### 框架选择指南

```go
// 性能测试代码
package main

import (
    "fmt"
    "net/http"
    "net/http/httptest"
    "testing"
    "time"
    "github.com/gin-gonic/gin"
    "github.com/labstack/echo/v4"
    "github.com/gofiber/fiber/v2"
)

// 标准库测试
func BenchmarkStdLib(b *testing.B) {
    handler := func(w http.ResponseWriter, r *http.Request) {
        w.WriteHeader(http.StatusOK)
        w.Write([]byte("Hello World"))
    }
    
    req := httptest.NewRequest("GET", "/", nil)
    
    b.ResetTimer()
    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            w := httptest.NewRecorder()
            handler(w, req)
        }
    })
}

// Gin测试
func BenchmarkGin(b *testing.B) {
    gin.SetMode(gin.ReleaseMode)
    r := gin.New()
    r.GET("/", func(c *gin.Context) {
        c.String(http.StatusOK, "Hello World")
    })
    
    req := httptest.NewRequest("GET", "/", nil)
    
    b.ResetTimer()
    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            w := httptest.NewRecorder()
            r.ServeHTTP(w, req)
        }
    })
}

// Echo测试
func BenchmarkEcho(b *testing.B) {
    e := echo.New()
    e.GET("/", func(c echo.Context) error {
        return c.String(http.StatusOK, "Hello World")
    })
    
    req := httptest.NewRequest("GET", "/", nil)
    
    b.ResetTimer()
    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            w := httptest.NewRecorder()
            e.ServeHTTP(w, req)
        }
    })
}

// Fiber测试
func BenchmarkFiber(b *testing.B) {
    app := fiber.New()
    app.Get("/", func(c *fiber.Ctx) error {
        return c.SendString("Hello World")
    })
    
    req := httptest.NewRequest("GET", "/", nil)
    
    b.ResetTimer()
    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            w := httptest.NewRecorder()
            app.Test(req)
        }
    })
}

// 框架选择决策矩阵
func FrameworkSelectionGuide() {
    fmt.Println("Web框架选择指南:")
    fmt.Println("================")
    
    fmt.Println("1. 标准库net/http:")
    fmt.Println("   - 优势: 无依赖、轻量、标准、灵活")
    fmt.Println("   - 劣势: 需要更多手动工作、功能相对简单")
    fmt.Println("   - 适用场景: 简单应用、学习目的、需要完全控制")
    
    fmt.Println("\n2. Gin:")
    fmt.Println("   - 优势: 高性能、中间件丰富、文档完善、社区活跃")
    fmt.Println("   - 劣势: 相对较重、学习曲线")
    fmt.Println("   - 适用场景: 中大型应用、需要高性能、快速开发")
    
    fmt.Println("\n3. Echo:")
    fmt.Println("   - 优势: 高性能、可扩展性强、中间件系统好")
    fmt.Println("   - 劣势: 社区相对较小")
    fmt.Println("   - 适用场景: 需要高度可定制的应用")
    
    fmt.Println("\n4. Fiber:")
    fmt.Println("   - 优势: 极高性能、类似Express.js、易学易用")
    fmt.Println("   - 劣势: 相对较新、生态系统在发展中")
    fmt.Println("   - 适用场景: 追求极致性能、Node.js开发者转Go")
}
```