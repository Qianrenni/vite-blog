## 8.1 项目结构

### 标准项目布局

Go项目通常遵循标准的目录结构：

```
myproject/
├── cmd/                    # 主应用程序
│   └── myapp/
│       └── main.go
├── internal/               # 私有应用程序代码
│   ├── handler/
│   ├── service/
│   └── repository/
├── pkg/                    # 可被外部使用的库代码
│   └── utils/
├── api/                    # API定义文件
│   └── proto/
├── configs/                # 配置文件
├── deployments/            # 部署相关文件
│   ├── docker/
│   └── kubernetes/
├── docs/                   # 文档
├── scripts/                # 脚本文件
├── test/                   # 测试数据和脚本
├── web/                    # Web资源
├── go.mod
├── go.sum
└── README.md
```

### 包组织结构

```go
// internal/handler/user_handler.go
package handler

import (
    "net/http"
    "myproject/internal/service"
)

type UserHandler struct {
    userService *service.UserService
}

func NewUserHandler(userService *service.UserService) *UserHandler {
    return &UserHandler{userService: userService}
}

func (h *UserHandler) GetUser(w http.ResponseWriter, r *http.Request) {
    // 处理逻辑
}

// internal/service/user_service.go
package service

import (
    "myproject/internal/repository"
)

type UserService struct {
    userRepo *repository.UserRepository
}

func NewUserService(userRepo *repository.UserRepository) *UserService {
    return &UserService{userRepo: userRepo}
}

func (s *UserService) GetUserByID(id int) (*User, error) {
    return s.userRepo.FindByID(id)
}
```

### 依赖管理（Go Modules）

#### 初始化模块
```bash
# 初始化新模块
go mod init github.com/username/myproject

# 添加依赖
go get github.com/gorilla/mux@v1.8.0
go get github.com/sirupsen/logrus@latest

# 清理未使用的依赖
go mod tidy
```

#### go.mod 文件示例
```go
module github.com/username/myproject

go 1.19

require (
    github.com/gorilla/mux v1.8.0
    github.com/sirupsen/logrus v1.9.0
    gorm.io/gorm v1.24.1
)

require (
    github.com/jinzhu/inflection v1.0.0 // indirect
    golang.org/x/sys v0.1.0 // indirect
)

replace github.com/username/oldmodule => github.com/username/newmodule v1.2.0
```

### 版本控制集成

#### Git 工作流
```bash
# 初始化Git仓库
git init
git add .
git commit -m "Initial commit"

# 创建分支进行开发
git checkout -b feature/user-management
git add .
git commit -m "Add user management feature"
git push origin feature/user-management

# 合并到主分支
git checkout main
git merge feature/user-management
```

#### GitHub Actions 配置
```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.19
    - name: Build
      run: go build -v ./...
    - name: Test
      run: go test -v ./...
```

### 多模块项目管理

#### 项目结构
```
monorepo/
├── go.mod
├── services/
│   ├── user/
│   │   ├── go.mod
│   │   └── main.go
│   └── order/
│       ├── go.mod
│       └── main.go
└── shared/
    ├── go.mod
    └── utils/
```

#### 主模块 go.mod
```go
module github.com/company/monorepo

go 1.19

require (
    github.com/company/monorepo/services/user v0.0.0
    github.com/company/monorepo/services/order v0.0.0
    github.com/company/monorepo/shared v0.0.0
)

replace (
    github.com/company/monorepo/services/user => ./services/user
    github.com/company/monorepo/services/order => ./services/order
    github.com/company/monorepo/shared => ./shared
)
```

### 私有模块处理

#### 配置私有模块
```bash
# 设置私有模块
go env -w GOPRIVATE=github.com/company/*

# 使用SSH认证
git config --global url."git@github.com:".insteadOf "https://github.com/"
```

#### 私有模块 go.mod
```go
module github.com/company/internal/pkg

go 1.19

require (
    github.com/company/shared v1.0.0
)
```

### 依赖版本锁定

#### 精确版本控制
```go
// go.mod
module myapp

go 1.19

require (
    github.com/gin-gonic/gin v1.9.1
    github.com/golang-jwt/jwt/v4 v4.5.0
    github.com/spf13/viper v1.15.0
)

// 锁定特定提交
replace github.com/gin-gonic/gin => github.com/gin-gonic/gin v1.9.1
```