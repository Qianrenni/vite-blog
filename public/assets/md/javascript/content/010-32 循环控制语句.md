## 3.2 循环控制语句

### for 循环的各种变体

#### 传统for循环

```javascript
// 基本语法
for (初始化; 条件; 迭代) {
    // 循环体
}

// 实际应用
for (let i = 0; i < 10; i++) {
    console.log(i);
}

// 数组遍历
const items = ['apple', 'banana', 'orange'];
for (let i = 0; i < items.length; i++) {
    console.log(`${i}: ${items[i]}`);
}
```

#### 倒序循环

```javascript
// 倒序遍历数组
for (let i = items.length - 1; i >= 0; i--) {
    console.log(items[i]);
}

// 倒序计数
for (let i = 10; i > 0; i--) {
    console.log(i);
}
```

#### 步长控制

```javascript
// 每次增加2
for (let i = 0; i < 20; i += 2) {
    console.log(i); // 0, 2, 4, 6, 8, 10, 12, 14, 16, 18
}

// 每次减少3
for (let i = 30; i > 0; i -= 3) {
    console.log(i); // 30, 27, 24, 21, 18, 15, 12, 9, 6, 3
}
```

### while 和 do...while 循环

#### while循环

```javascript
// 基本语法
while (条件) {
    // 循环体
    // 必须有改变条件的语句
}

// 实际应用
let count = 0;
while (count < 5) {
    console.log(count);
    count++;
}

// 用户输入验证
let userInput;
while (!userInput || userInput.trim() === '') {
    userInput = prompt('请输入有效内容:');
}
```

#### do...while循环

```javascript
// 基本语法
do {
    // 循环体
    // 至少执行一次
} while (条件);

// 实际应用
let password;
do {
    password = prompt('请输入密码:');
} while (password !== 'secret123');

// 菜单系统
let choice;
do {
    choice = prompt('选择操作: 1-添加 2-删除 3-退出');
    switch (choice) {
        case '1':
            addItem();
            break;
        case '2':
            removeItem();
            break;
        case '3':
            console.log('退出程序');
            break;
        default:
            console.log('无效选择');
    }
} while (choice !== '3');
```

#### 两种循环的区别

```javascript
// while循环 - 条件先判断
let i = 5;
while (i < 3) {
    console.log('这不会执行'); // 条件一开始就不满足
    i++;
}

// do...while循环 - 至少执行一次
let j = 5;
do {
    console.log('这会执行一次'); // 先执行，再判断条件
    j++;
} while (j < 3);
```

### for...in 和 for...of 循环的区别

#### for...in 循环

```javascript
// 用于遍历对象的可枚举属性
const person = {
    name: 'Alice',
    age: 30,
    city: 'New York'
};

for (let key in person) {
    console.log(`${key}: ${person[key]}`);
}
// 输出: name: Alice, age: 30, city: New York

// 遍历数组（不推荐）
const colors = ['red', 'green', 'blue'];
for (let index in colors) {
    console.log(`${index}: ${colors[index]}`);
}
// 输出: 0: red, 1: green, 2: blue
```

#### for...of 循环

```javascript
// 用于遍历可迭代对象（数组、字符串、Map、Set等）
const fruits = ['apple', 'banana', 'orange'];

// 遍历数组元素
for (let fruit of fruits) {
    console.log(fruit);
}
// 输出: apple, banana, orange

// 遍历字符串
const message = 'Hello';
for (let char of message) {
    console.log(char);
}
// 输出: H, e, l, l, o

// 遍历Set
const uniqueNumbers = new Set([1, 2, 3, 4]);
for (let num of uniqueNumbers) {
    console.log(num);
}

// 遍历Map
const userRoles = new Map([
    ['alice', 'admin'],
    ['bob', 'user'],
    ['charlie', 'moderator']
]);

for (let [user, role] of userRoles) {
    console.log(`${user}: ${role}`);
}
```

#### 关键区别对比

```javascript
const arr = [10, 20, 30];
arr.customProperty = 'test'; // 添加自定义属性

// for...in 遍历所有可枚举属性（包括自定义属性）
for (let key in arr) {
    console.log(key, arr[key]);
}
// 输出: 0 10, 1 20, 2 30, customProperty test

// for...of 只遍历值
for (let value of arr) {
    console.log(value);
}
// 输出: 10, 20, 30
```

### 循环控制语句 break 和 continue

#### break语句

```javascript
// 基本用法 - 跳出循环
for (let i = 0; i < 10; i++) {
    if (i === 5) {
        break; // 当i等于5时跳出循环
    }
    console.log(i);
}
// 输出: 0, 1, 2, 3, 4

// 在嵌套循环中使用
outer: for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 3; j++) {
        if (i === 1 && j === 1) {
            break outer; // 跳出外层循环
        }
        console.log(`i: ${i}, j: ${j}`);
    }
}
// 输出: i: 0, j: 0; i: 0, j: 1; i: 0, j: 2; i: 1, j: 0
```

#### continue语句

```javascript
// 基本用法 - 跳过当前迭代
for (let i = 0; i < 10; i++) {
    if (i % 2 === 0) {
        continue; // 跳过偶数
    }
    console.log(i);
}
// 输出: 1, 3, 5, 7, 9

// 在while循环中使用
let count = 0;
while (count < 10) {
    count++;
    if (count % 3 === 0) {
        continue; // 跳过3的倍数
    }
    console.log(count);
}
// 输出: 1, 2, 4, 5, 7, 8, 10
```

#### 实际应用场景

```javascript
// 查找特定元素
function findUser(users, targetId) {
    for (let user of users) {
        if (user.id === targetId) {
            return user;
        }
    }
    return null;
}

// 数据过滤和处理
function processNumbers(numbers) {
    const result = [];
    for (let num of numbers) {
        if (num < 0) {
            continue; // 跳过负数
        }
        if (num > 100) {
            break; // 遇到大于100的数就停止
        }
        result.push(num * 2);
    }
    return result;
}

// 错误处理
function validateData(dataList) {
    const errors = [];
    for (let data of dataList) {
        if (!data.requiredField) {
            errors.push('Missing required field');
            continue;
        }
        if (data.value < 0) {
            errors.push('Negative value not allowed');
            continue;
        }
        // 处理有效数据
        processData(data);
    }
    return errors;
}
```

### 循环性能优化建议

#### 1. 缓存数组长度

```javascript
// 不推荐
for (let i = 0; i < array.length; i++) {
    // 每次都计算array.length
}

// 推荐
for (let i = 0, len = array.length; i < len; i++) {
    // 只计算一次长度
}
```

#### 2. 选择合适的循环方式

```javascript
const numbers = [1, 2, 3, 4, 5];

// 对于简单遍历，for...of通常最快
for (let num of numbers) {
    console.log(num);
}

// 对于需要索引的情况，传统for循环
for (let i = 0; i < numbers.length; i++) {
    console.log(`${i}: ${numbers[i]}`);
}

// 对于函数式编程，使用数组方法
numbers.forEach(num => console.log(num));
```