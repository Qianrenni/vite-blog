## 7.1 正则表达式基础

### 1. 正则表达式语法和模式

```javascript
// 正则表达式基本语法
// 字面量形式
const regex1 = /pattern/flags;
const regex2 = /hello/i; // 不区分大小写

// 构造函数形式
const regex3 = new RegExp('pattern', 'flags');
const regex4 = new RegExp('hello', 'i');

// 基本字符匹配
const text = 'Hello World';
console.log(/Hello/.test(text)); // true
console.log(/hello/.test(text)); // false (区分大小写)
console.log(/hello/i.test(text)); // true (不区分大小写)

// 特殊字符
// . 匹配除换行符外的任意字符
console.log(/h.llo/.test('hello')); // true
console.log(/h.llo/.test('hallo')); // true
console.log(/h.llo/.test('h\nllo')); // false

// ^ 匹配行首
console.log(/^Hello/.test('Hello World')); // true
console.log(/^World/.test('Hello World')); // false

// $ 匹配行尾
console.log(/World$/.test('Hello World')); // true
console.log(/Hello$/.test('Hello World')); // false

// \b 匹配单词边界
console.log(/\bWorld\b/.test('Hello World')); // true
console.log(/\bWorld\b/.test('Hello Worldwide')); // false

// \B 匹配非单词边界
console.log(/\Borld\B/.test('Worldwide')); // true

// 转义特殊字符
const specialChars = /\.\^\$\*\+\?\(\)\[\]\{\}\|\\/;
console.log(specialChars.test('.^$*+?()[]{}|\\')); // true
```

### 2. 字面量和构造函数创建方式

```javascript
// 字面量形式 - 编译时确定
const literalRegex = /hello \d+/i;
console.log(literalRegex.test('Hello 123')); // true

// 构造函数形式 - 运行时确定
const pattern = 'hello \\d+';
const constructorRegex = new RegExp(pattern, 'i');
console.log(constructorRegex.test('Hello 123')); // true

// 动态创建正则表达式
function createEmailRegex(domains) {
    const domainPattern = domains.join('|');
    return new RegExp(`^[\\w.-]+@(${domainPattern})$`, 'i');
}

const emailRegex = createEmailRegex(['gmail.com', 'yahoo.com', 'outlook.com']);
console.log(emailRegex.test('user@gmail.com')); // true
console.log(emailRegex.test('user@hotmail.com')); // false

// 转义注意事项
// 字面量中的反斜杠需要双重转义
const literalPattern = /\d+\.\d+/; // 匹配数字.数字

// 构造函数中的反斜杠需要四重转义
const constructorPattern = new RegExp('\\d+\\.\\d+');

// 实际应用：动态验证规则
function createValidator(pattern, flags = '') {
    if (typeof pattern === 'string') {
        return new RegExp(pattern, flags);
    }
    return pattern;
}

const phoneValidator = createValidator('^\\d{3}-\\d{3}-\\d{4}$');
const emailValidator = createValidator('^[\\w.-]+@[\\w.-]+\\.[\\w]+$');

console.log(phoneValidator.test('123-456-7890')); // true
console.log(emailValidator.test('user@example.com')); // true
```

### 3. 标志位的含义和作用

```javascript
// 正则表达式标志位

// i - 不区分大小写 (ignore case)
const caseInsensitive = /hello/i;
console.log(caseInsensitive.test('Hello')); // true
console.log(caseInsensitive.test('HELLO')); // true
console.log(caseInsensitive.test('HeLLo')); // true

// g - 全局匹配 (global)
const globalRegex = /hello/g;
const text = 'Hello hello HELLO';
console.log(text.match(globalRegex)); // ['hello'] (不区分大小写的情况下)
const caseSensitiveGlobal = /hello/g;
console.log(text.match(caseSensitiveGlobal)); // ['hello'] (只匹配第一个)

// m - 多行模式 (multiline)
const multilineText = `Line 1
Line 2
Line 3`;

const withoutM = /^Line/g;
console.log(multilineText.match(withoutM)); // ['Line'] - 只匹配第一行

const withM = /^Line/mg;
console.log(multilineText.match(withM)); // ['Line', 'Line', 'Line'] - 匹配每行开头

// s - dotAll 模式 (ES2018) - 让 . 匹配换行符
const dotAllRegex = /hello.world/s;
const textWithNewline = 'hello\nworld';
console.log(dotAllRegex.test(textWithNewline)); // true (with s flag)
console.log(/hello.world/.test(textWithNewline)); // false (without s flag)

// u - Unicode 模式
const unicodeRegex = /\u{1F600}/u; // 匹配笑脸表情符号
console.log(unicodeRegex.test('😀')); // true

// y - 粘性匹配 (sticky)
const stickyRegex = /hello/y;
const text2 = 'hello world hello';
console.log(stickyRegex.test(text2)); // true
stickyRegex.lastIndex = 6; // 设置匹配位置
console.log(stickyRegex.test(text2)); // false (位置6不是'hello')

// 标志位组合使用
const complexRegex = /hello world/gim;
// g - 全局匹配
// i - 不区分大小写  
// m - 多行模式

// 检查和修改标志位
const regex = /hello/gi;
console.log(regex.flags); // 'gi'
console.log(regex.global); // true
console.log(regex.ignoreCase); // true
console.log(regex.multiline); // false

// 注意：标志位在创建后不能修改
// regex.global = false; // 无效
```

### 4. 字符类和量词使用

```javascript
// 字符类 (Character Classes)

// [abc] - 匹配方括号内任意字符
const vowelRegex = /[aeiou]/g;
const text = 'hello world';
console.log(text.match(vowelRegex)); // ['e', 'o', 'o']

// [a-z] - 匹配范围内的字符
const lowercaseRegex = /[a-z]/g;
console.log('Hello123'.match(lowercaseRegex)); // ['e', 'l', 'l', 'o']

// [^abc] - 匹配除了方括号内字符以外的任意字符
const nonVowelRegex = /[^aeiou\s]/g; // 非元音字母且非空白字符
console.log('hello world'.match(nonVowelRegex)); // ['h', 'l', 'l', 'w', 'r', 'l', 'd']

// 预定义字符类
console.log(/\d/.test('123')); // true - 数字 [0-9]
console.log(/\D/.test('abc')); // true - 非数字 [^0-9]
console.log(/\w/.test('a1_')); // true - 单词字符 [a-zA-Z0-9_]
console.log(/\W/.test(' @')); // true - 非单词字符 [^a-zA-Z0-9_]
console.log(/\s/.test(' \t\n')); // true - 空白字符
console.log(/\S/.test('abc')); // true - 非空白字符

// 量词 (Quantifiers)

// * - 匹配0次或多次
const zeroOrMore = /go*l/; // g + 0个或多个o + l
console.log(zeroOrMore.test('gl')); // true
console.log(zeroOrMore.test('gol')); // true
console.log(zeroOrMore.test('gooool')); // true

// + - 匹配1次或多次
const oneOrMore = /go+l/; // g + 1个或多个o + l
console.log(oneOrMore.test('gl')); // false
console.log(oneOrMore.test('gol')); // true
console.log(oneOrMore.test('gooool')); // true

// ? - 匹配0次或1次
const zeroOrOne = /go?l/; // g + 0个或1个o + l
console.log(zeroOrOne.test('gl')); // true
console.log(zeroOrOne.test('gol')); // true
console.log(zeroOrOne.test('gooool')); // false

// {n} - 匹配恰好n次
const exactlyThree = /a{3}/; // 恰好3个a
console.log(exactlyThree.test('aa')); // false
console.log(exactlyThree.test('aaa')); // true
console.log(exactlyThree.test('aaaa')); // true (匹配前3个)

// {n,} - 匹配至少n次
const atLeastTwo = /a{2,}/; // 至少2个a
console.log(atLeastTwo.test('a')); // false
console.log(atLeastTwo.test('aa')); // true
console.log(atLeastTwo.test('aaaaa')); // true

// {n,m} - 匹配n到m次
const twoToFour = /a{2,4}/; // 2到4个a
console.log(twoToFour.test('a')); // false
console.log(twoToFour.test('aa')); // true
console.log(twoToFour.test('aaaaa')); // true (匹配前4个)

// 贪婪与非贪婪匹配
const text2 = '<div>Hello</div><div>World</div>';

// 贪婪匹配 (默认) - 匹配尽可能多的字符
const greedy = /<div>.*<\/div>/;
console.log(text2.match(greedy)[0]); // '<div>Hello</div><div>World</div>'

// 非贪婪匹配 - 匹配尽可能少的字符
const nonGreedy = /<div>.*?<\/div>/g;
console.log(text2.match(nonGreedy)); // ['<div>Hello</div>', '<div>World</div>']

// 分组和捕获
const dateRegex = /(\d{4})-(\d{2})-(\d{2})/;
const date = '2023-12-25';
const match = date.match(dateRegex);
console.log(match); // ['2023-12-25', '2023', '12', '25']
console.log(match[1]); // '2023' (年)
console.log(match[2]); // '12' (月)
console.log(match[3]); // '25' (日)

// 非捕获分组
const nonCapturing = /(?:https?):\/\/(\w+)/;
const url = 'https://example.com';
const urlMatch = url.match(nonCapturing);
console.log(urlMatch); // ['https://example', 'example'] (没有捕获协议部分)

// 命名捕获组 (ES2018)
const namedGroups = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;
const namedMatch = '2023-12-25'.match(namedGroups);
console.log(namedMatch.groups.year); // '2023'
console.log(namedMatch.groups.month); // '12'
console.log(namedMatch.groups.day); // '25'
```