## 2.3 运算符体系

### 算术运算符和优先级

```javascript
// 基本算术运算符
let a = 10, b = 3;
console.log(a + b);  // 13 - 加法
console.log(a - b);  // 7 - 减法
console.log(a * b);  // 30 - 乘法
console.log(a / b);  // 3.333... - 除法
console.log(a % b);  // 1 - 取模
console.log(a ** b); // 1000 - 幂运算 (10的3次方)

// 一元运算符
let x = 5;
console.log(++x);    // 6 - 前置递增
console.log(x++);    // 6 - 后置递增，返回递增前的值
console.log(x);      // 7

let y = 5;
console.log(--y);    // 4 - 前置递减
console.log(y--);    // 4 - 后置递减，返回递减前的值
console.log(y);      // 3

console.log(+x);     // 7 - 转换为数字
console.log(-x);     // -7 - 转换为数字并取反

// 运算符优先级
let result1 = 2 + 3 * 4;        // 14 (乘法优先)
let result2 = (2 + 3) * 4;      // 20 (括号优先)
let result3 = 2 ** 3 * 4;       // 32 (幂运算优先级高于乘法)
let result4 = 2 + 3 - 1;        // 4 (同级从左到右)

// 特殊运算规则
console.log(0 / 0);             // NaN
console.log(1 / 0);             // Infinity
console.log(-1 / 0);            // -Infinity
console.log(Infinity + 1);      // Infinity
console.log(Infinity - Infinity); // NaN
```

### 比较运算符和相等性判断

```javascript
// 比较运算符
console.log(5 > 3);             // true
console.log(5 < 3);             // false
console.log(5 >= 5);            // true
console.log(5 <= 4);            // false

// 相等性判断
console.log(5 == "5");          // true (抽象相等，类型转换)
console.log(5 === "5");         // false (严格相等，不转换)
console.log(5 != "6");          // true (抽象不等)
console.log(5 !== "5");         // true (严格不等)

// Object.is() 方法
console.log(Object.is(5, 5));           // true
console.log(Object.is(0, -0));          // false
console.log(Object.is(NaN, NaN));       // true
console.log(Object.is(null, undefined)); // false

// 类型转换规则示例
console.log("10" > 9);          // true (字符串转数字)
console.log(true > 0);          // true (布尔转数字)
console.log(false == 0);        // true (布尔转数字)
console.log("" == 0);           // true (空字符串转数字)
console.log(" " == 0);          // true (空白字符串转数字)
console.log("0" == false);      // true (复杂转换链)

// 比较特殊情况
console.log(NaN == NaN);        // false
console.log(NaN === NaN);       // false
console.log(NaN != NaN);        // true
console.log(NaN !== NaN);       // true

console.log(null == undefined); // true
console.log(null === undefined); // false

console.log(0 == false);        // true
console.log(0 === false);       // false

console.log("" == false);       // true
console.log("" === false);      // false
```

### 逻辑运算符和短路求值

```javascript
// 基本逻辑运算符
console.log(true && true);      // true
console.log(true && false);     // false
console.log(false && true);     // false
console.log(false && false);    // false

console.log(true || true);      // true
console.log(true || false);     // true
console.log(false || true);     // true
console.log(false || false);    // false

console.log(!true);             // false
console.log(!false);            // true

// 短路求值特性
let obj = null;
// console.log(obj.name);       // TypeError
console.log(obj && obj.name);  // null (短路，不执行 obj.name)

let user = { name: "张三" };
console.log(user && user.name); // "张三" (不短路，执行 user.name)

let defaultName = "默认用户";
let userName = "" || defaultName; // "默认用户" (空字符串为 falsy)

// 返回值特点
console.log("hello" && "world"); // "world" (最后一个真值)
console.log("hello" && 0 && "world"); // 0 (第一个假值)
console.log("hello" || "world"); // "hello" (第一个真值)
console.log("" || 0 || "default"); // "default" (最后一个假值)

// 实际应用
function greet(name) {
    name = name || "访客"; // 设置默认值
    console.log("你好, " + name);
}

greet();        // "你好, 访客"
greet("张三");   // "你好, 张三"

// 新增逻辑运算符
// 空值合并运算符 ??
let value1 = null ?? "默认值";    // "默认值"
let value2 = undefined ?? "默认值"; // "默认值"
let value3 = "" ?? "默认值";      // "" (空字符串不是 null/undefined)
let value4 = 0 ?? "默认值";       // 0 (0 不是 null/undefined)

// 逻辑赋值运算符
let obj1 = { x: 1, y: 0 };
obj1.x &&= 2;   // obj1.x = 2 (因为 x 为真)
obj1.y &&= 3;   // obj1.y = 0 (因为 y 为假，不执行赋值)
obj1.z ||= 10;  // obj1.z = 10 (因为 z 为 undefined，为假)
obj1.x ||= 20;  // obj1.x = 2 (因为 x 为真，不执行赋值)

let obj2 = { a: null, b: 0 };
obj2.a ??= "默认"; // obj2.a = "默认" (因为 a 为 null)
obj2.b ??= "默认"; // obj2.b = 0 (因为 b 不是 null/undefined)
```

### 赋值运算符和复合赋值

```javascript
// 基本赋值运算符
let a = 10;
let b = 20;
let c = 30;

// 链式赋值
let x = y = z = 5; // x=5, y=5, z=5

// 解构赋值
// 数组解构
let [first, second, third] = [1, 2, 3];
console.log(first);  // 1
console.log(second); // 2
console.log(third);  // 3

// 带默认值的数组解构
let [p, q = 10, r = 20] = [1, 2];
console.log(p); // 1
console.log(q); // 2
console.log(r); // 20

// 剩余元素
let [head, ...tail] = [1, 2, 3, 4, 5];
console.log(head); // 1
console.log(tail); // [2, 3, 4, 5]

// 对象解构
let person = { name: "张三", age: 25, city: "北京" };
let { name, age } = person;
console.log(name); // "张三"
console.log(age);  // 25

// 重命名属性
let { name: fullName, age: userAge } = person;
console.log(fullName); // "张三"
console.log(userAge);  // 25

// 带默认值的对象解构
let { job = "程序员", salary = 8000 } = person;
console.log(job);    // "程序员" (person中没有job属性)
console.log(salary); // 8000

// 嵌套解构
let company = {
    name: "科技公司",
    address: {
        city: "深圳",
        district: "南山区"
    },
    employees: ["张三", "李四"]
};

let { 
    name: companyName,
    address: { city, district },
    employees: [emp1, emp2]
} = company;

console.log(companyName); // "科技公司"
console.log(city);        // "深圳"
console.log(district);    // "南山区"
console.log(emp1);        // "张三"
console.log(emp2);        // "李四"

// 复合赋值运算符
let num = 10;
num += 5;   // num = num + 5 = 15
num -= 3;   // num = num - 3 = 12
num *= 2;   // num = num * 2 = 24
num /= 4;   // num = num / 4 = 6
num %= 4;   // num = num % 4 = 2
num **= 3;  // num = num ** 3 = 8

// 位运算赋值
let flag = 5; // 二进制: 101
flag <<= 1;   // 左移一位: 1010 (10)
flag >>= 1;   // 右移一位: 101 (5)
flag &= 3;    // 按位与: 101 & 011 = 001 (1)
flag |= 2;    // 按位或: 001 | 010 = 011 (3)
flag ^= 1;    // 按位异或: 011 ^ 001 = 010 (2)

// 赋值运算特点
let result = (a = 5); // 赋值表达式的返回值是赋值的值
console.log(result);  // 5
console.log(a);       // 5

// 解构赋值的实际应用
// 交换变量值
let m = 1, n = 2;
[m, n] = [n, m];
console.log(m); // 2
console.log(n); // 1

// 函数参数解构
function printUser({ name, age, city = "未知" }) {
    console.log(`${name}, ${age}岁, 来自${city}`);
}

printUser({ name: "张三", age: 25 }); // "张三, 25岁, 来自未知"

// 返回多个值
function getCoordinates() {
    return [100, 200];
}

let [x, y] = getCoordinates();
console.log(`坐标: (${x}, ${y})`); // "坐标: (100, 200)"
```