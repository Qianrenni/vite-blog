## 10.2 模块化系统

### 模块导入导出语法

```javascript
// math.js - 命名导出
export const PI = 3.14159;
export function add(a, b) {
  return a + b;
}
export function subtract(a, b) {
  return a - b;
}

// 另一种命名导出方式
const multiply = (a, b) => a * b;
const divide = (a, b) => a / b;
export { multiply, divide };

// 默认导出
export default function calculator(a, b) {
  return {
    add: add(a, b),
    subtract: subtract(a, b),
    multiply: multiply(a, b),
    divide: divide(a, b)
  };
}

// main.js - 导入语法
// 导入命名导出
import { PI, add, subtract } from './math.js';
import { multiply as mul, divide } from './math.js';

// 导入默认导出
import calc from './math.js';

// 导入所有内容
import * as math from './math.js';

console.log(PI); // 3.14159
console.log(add(5, 3)); // 8
console.log(mul(5, 3)); // 15
console.log(calc(10, 2)); // { add: 12, subtract: 8, multiply: 20, divide: 5 }
console.log(math.PI); // 3.14159
```

### 模块加载机制

```javascript
// 动态导入
async function loadModule() {
  try {
    const module = await import('./math.js');
    console.log(module.add(5, 3)); // 8
  } catch (error) {
    console.error('模块加载失败:', error);
  }
}

// 条件导入
if (process.env.NODE_ENV === 'development') {
  import('./dev-tools.js').then(module => {
    module.enableDebug();
  });
}

// 按需加载
document.getElementById('loadButton').addEventListener('click', async () => {
  const { heavyFunction } = await import('./heavy-module.js');
  heavyFunction();
});
```

### 循环依赖处理

```javascript
// a.js
import { functionB } from './b.js';

export function functionA() {
  console.log('Function A');
  // 避免在模块初始化时调用可能造成循环依赖的函数
}

export function callB() {
  functionB(); // 运行时调用是安全的
}

// b.js
import { functionA } from './a.js';

export function functionB() {
  console.log('Function B');
}

export function callA() {
  functionA();
}

// main.js
import { callA } from './a.js';
import { callB } from './b.js';

callA(); // Function A
callB(); // Function B
```

### 动态导入特性

```javascript
// 基本动态导入
async function loadLodash() {
  const { default: _ } = await import('lodash');
  return _;
}

// 条件动态导入
async function loadChartLibrary(chartType) {
  switch (chartType) {
    case 'bar':
      return await import('./bar-chart.js');
    case 'line':
      return await import('./line-chart.js');
    case 'pie':
      return await import('./pie-chart.js');
    default:
      throw new Error('Unsupported chart type');
  }
}

// 错误处理
async function safeImport(modulePath) {
  try {
    return await import(modulePath);
  } catch (error) {
    console.warn(`Failed to load module ${modulePath}:`, error);
    return null;
  }
}

// 并行动态导入
async function loadMultipleModules() {
  const [moduleA, moduleB, moduleC] = await Promise.all([
    import('./module-a.js'),
    import('./module-b.js'),
    import('./module-c.js')
  ]);
  
  return { moduleA, moduleB, moduleC };
}
```