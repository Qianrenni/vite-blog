## **3.4. 多级页表（Multi-level Page Table）**

### **背景**

传统的单级页表在处理大地址空间时存在严重的内存浪费问题。例如，在 32 位系统中，如果页大小为 4KB，页表需要存储 \(2^{20}\) 个条目（因为 \(2^{32} / 2^{12} = 2^{20}\)），即使只使用少量页也会占用大量内存。

### **基本思想**

多级页表通过将页表分层，仅保留实际使用的部分，从而减少内存开销。

### **工作原理**

以两级页表为例：

1. **虚拟地址结构**：
   - 页目录号（Page Directory Index）
   - 页表号（Page Table Index）
   - 页内偏移量（Offset）
2. **页目录（Page Directory）**：
   - 每个页目录项指向一个页表。
3. **页表（Page Table）**：
   - 每个页表项指向一个物理页框。
4. **查找过程**：
   - 根据页目录号找到对应的页表。
   - 根据页表号找到对应的物理页框。
   - 结合页内偏移量计算最终物理地址。

### **优点**

- **节省内存**：只有实际使用的页表才被分配内存。
- **扩展性强**：支持更大的地址空间（如 64 位系统）。

### **缺点**

- **访问延迟增加**：需要多次查表操作（可以通过 TLB 缓存优化）。
- **实现复杂**：需要维护多级结构。

### **示例**

假设页大小为 4KB，页表项大小为 4 字节：

- 单级页表需要 \(2^{20} \times 4\) 字节（即 4MB）。
- 使用两级页表后，每级只需要 \(2^{10} \times 4\) 字节（即 4KB），总共只需要两份 4KB 的页表。

---

好的！接下来我们将以类似的方式讲解段页式内存管理（Segmented Paging Memory Management）。段页式内存管理结合了分段和分页两种技术的优点，既提供了逻辑上的模块化划分（分段），又通过分页实现了高效的内存使用和管理。

---